#
#   -- NetITWorks Policy --
#
#   This policy checks that the client has given the correct
#   username and password details
# 
check_credentials {

    #IF Username exists
    if("%{sql:SELECT COUNT(id) from net_user where net_user.id = '%{User-Name}'}" > 0){

        #Check password passing it to CHAP
        update reply {
            &config:Cleartext-Password = "%{sql:SELECT password FROM net_user WHERE id='%{User-Name}'}"
        }
    }

    else{
        #Reject authorization 
        reject
    }
}